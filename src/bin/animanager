#!/usr/bin/env python3

import logging
import atexit
import argparse

from animanager import db
from animanager import locator
from animanager import scene
from animanager.scene import menu


def main():

    parser = argparse.ArgumentParser(
        description='Anime Manager MySQL frontend.')
    parser.add_argument('--loglevel', action='store', default='info')
    parser.add_argument('--logfile', action='store', default='')
    args = parser.parse_args()

    config = {'format': '%(asctime)s %(levelname)s %(name)s %(message)s'}
    try:
        config['level'] = getattr(logging, args.loglevel.upper())
    except AttributeError:
        raise ValueError('Invalid log level: {!s}'.format(args.loglevel))
    if args.logfile:
        config['filename'] = args.logfile
    logging.basicConfig(**config)

    locator.db = db.AnimeDB()
    atexit.register(locator.db.close)

    locator.stack = scene.SceneStack()
    locator.stack.add((menu.main_menu, [], {}))

    locator.stack.run()

if __name__ == "__main__":
    main()
